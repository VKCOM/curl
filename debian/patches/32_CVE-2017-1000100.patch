From 241dc3b7cd36b329c6cebacc2193b82a130d8f1c Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Mon, 31 Jul 2017 18:50:52 +0200
Subject: [PATCH] tftp: reject file name lengths that don't fit

... and thereby avoid telling send() to send off more bytes than the
size of the buffer!

Bug:
Reported-by: Even Rouault
---
 lib/tftp.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

--- a/lib/tftp.c
+++ b/lib/tftp.c
@@ -492,6 +492,11 @@
     if(!filename)
       return CURLE_OUT_OF_MEMORY;
 
+    if(strlen(filename) > (state->blksize - strlen(mode) - 4)) {
+      failf(data, "TFTP file name too long\n");
+      return CURLE_TFTP_ILLEGAL; /* too long file name field */
+    }
+
     snprintf((char *)state->spacket.data+2,
              state->blksize,
              "%s%c%s%c", filename, '\0',  mode, '\0');
